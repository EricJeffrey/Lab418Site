<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>实验室网站</title>
    <link rel="stylesheet" href="index.css">
    <link rel="stylesheet" href="card.css">
    <script src="/jquery.min.js"></script>
    <script>
        // args: { innerText, attrList }
        function createElement(tag, args) {
            var res;
            if (tag == "svg" || tag == "path")
                res = document.createElementNS('http://www.w3.org/2000/svg', tag);
            else
                res = document.createElement(tag);
            if (args) {
                res.innerText = args.innerText || "";
                for (const key in args.attrList || {})
                    if (args.attrList.hasOwnProperty(key))
                        res.setAttribute(key, args.attrList[key]);
            }
            return res;
        }

        function appendChildList(father, childList) {
            for (let i = 0; i < childList.length; i++) {
                const element = childList[i];
                father.append(element);
            }
        }

        function createDocCard(doc, editOnClick, deleteOnClick) {
            const editSVGPathList = [
                createElement("path", {
                    attrList: {
                        d: "M532.392 320.217c58.751 58.642 116.557 116.356 176.408 176.083-1.934 1.161-4.921 2.257-6.976 4.299-87.523 86.596-175.141 173.078-262.184 260.154-11.369 11.369-23.604 18.609-38.937 22.958-59.724 16.953-119.201 34.773-178.802 52.192-13.288 3.881-23.684 0.384-30.382-9.934-4.424-6.804-4.409-14.246-2.259-21.625 19.028-65.153 38.084-130.294 57.421-195.34 1.409-4.703 4.409-9.468 7.904-12.947 90.756-90.028 181.7-179.871 272.563-269.778 1.962-1.95 3.635-4.206 5.243-6.063zM289.594 637.111c-0.913 2.722-1.626 4.672-2.212 6.668-8.047 27.285-15.1 54.914-24.474 81.737-4.887 13.983-3.541 23.822 8.664 32.128 2.257 1.533 4.207 3.696 5.891 5.876 2.662 3.482 5.631 3.577 9.576 2.383 22.307-6.743 44.69-13.269 67.058-19.844 11.186-3.296 22.382-6.561 34.358-10.055-1.872-2.137-2.893-3.82-4.362-4.873-9.205-6.667-13.288-15.516-12.452-26.902 0.323-4.239-0.247-8.554-0.496-12.837-0.727-11.88-1.484-23.762-2.259-35.922-16.366-1.345-31.911-2.968-47.487-3.772-11.372-0.589-22.105-1.72-29.051-12.347-0.435-0.663-1.284-1.065-2.752-2.241z",
                        "p-id": "1179"
                    }
                }),
                createElement("path", {
                    attrList: {
                        d: "M794.821 397.313c-55.549-55.47-110.991-110.849-167.034-166.816 13.474-12.252 24.335-28.292 42.046-36.83 21.346-10.272 47.875-5.414 66.808 13.194 27.49 27.038 54.87 54.218 81.786 81.846 24.887 25.522 24.47 59.989-0.309 85.51-7.752 7.968-15.779 15.656-23.296 23.095z",
                        "p-id": "1180"
                    }
                }),
                createElement("path", {
                    attrList: {
                        d: "M772.144 430.138c-12.482 11.696-25.447 23.822-38.101 35.671-58.284-58.284-116.2-116.186-174.425-174.411 12.762-11.958 25.708-24.1 38.083-35.705 58.194 58.18 116.062 116.050 174.442 174.443z",
                        "p-id": "1181"
                    }
                })
            ];
            const deleteSVGPathList = [
                createElement("path", {
                    attrList: {
                        d: "M128 213.33h768v85.33H128zM384 85.33h256v85.33H384zM384 384h85.33v384H384zM554.67 384H640v384h-85.33z",
                        "p-id": "2389"
                    }
                }),
                createElement("path", {
                    attrList: {
                        d: "M725.33 853.33H298.67V384h-85.34v554.67h597.34V384h-85.34z",
                        "p-id": "2390"
                    }
                })
            ];

            const card = createElement("div", { attrList: { class: "card" } });
            const cardHeader = createElement("div", { attrList: { class: "card-header" } });
            const cardTitle = createElement("span", {
                innerText: doc.title,
                attrList: { class: "card-title" }
            });
            const cardEditSVG = createElement("svg", {
                attrList: {
                    class: "card-edit icon",
                    t: "1596247894872", viewBox: "0 0 1024 1024", version: "1.1",
                    xmlns: "http://www.w3.org/2000/svg", "p-id": "1178", width: "32", height: "32"
                }
            });
            const cardDeleteSVG = createElement("svg", {
                attrList: {
                    class: "card-delete icon", t: "1596248692838", viewBox: "0 0 1024 1024",
                    version: "1.1", xmlns: "http://www.w3.org/2000/svg", "p-id": "2388",
                    width: "32", height: "32"
                }
            });
            const spanPara = createElement("span", {
                innerText: doc.paragraph,
                class: "card-paragraph"
            });

            // append child
            appendChildList(cardEditSVG, editSVGPathList);
            appendChildList(cardDeleteSVG, deleteSVGPathList);
            appendChildList(cardHeader, [cardTitle, cardEditSVG, cardDeleteSVG]);
            appendChildList(card, [cardHeader, spanPara]);

            // listener
            cardEditSVG.onclick = editOnClick;
            cardDeleteSVG.onclick = deleteOnClick;

            return card;
        }

        function createDocs(docList) {
            const logListener = (e) => console.log(e);
            var cardsList = [];
            docList.forEach(doc => cardsList.push(createDocCard(doc, logListener, logListener)));
            appendChildList(document.getElementById("docList"), cardsList);
        }

        // menuList = [ {text: "", callback: (event)=>{} } ]
        function createMenu(menuList) {
            var menus = [];
            for (let i = 0; i < menuList.length; i++) {
                const item = menuList[i];
                var menuElement = createElement("li", {
                    innerText: item.text,
                    attrList: {
                        class: "menu-item"
                    }
                });
                menuElement.onclick = item.onclick;
                menus.push(menuElement);
            }
            const menu = document.getElementById("menu-ul");
            appendChildList(menu, menus);
            return menu;
        }

        var router = {
            toLabDoc: function () {
                // todo hide it, show another?
                // location.hash = "#docs";
                // document.getElementById("docs").style.display = "none";
            }
        };

        var client = {
            getDoc: function (onSuccess, onFail) {
                $.get("/doc", (data, status, xhr) => {
                    if (xhr.status == 200)
                        onSuccess(JSON.parse(data));
                    else onFail(data, status, xhr);
                });
            }
        };

        const menuList = [
            {
                text: "实验室常用信息",
                onclick: (e) => router.toLabDoc()
            }
        ];

        var drawer = (function () {
            var res = { element: null, showing: false, width: null };
            res.init = function (id) {
                res.element = document.getElementById(id);
                res.showing = true;
            };
            res.toggle = function () {
                res.element.style.display = (res.showing ? "none" : "flex");
                res.showing = !res.showing;
            };
            return res;
        })();

        function init() {
            document.getElementById("menu-title").onclick = (e) => { location.href = "/index.html" };
            const menu = createMenu(menuList);
            drawer.init("drawer-menu");
            document.getElementById("docTitle").onclick = e => drawer.toggle();
        }

        window.onload = function () {
            init();
            client.getDoc((data) => { createDocs(data); }, (data, status, xhr) => {
                console.error("Failed to get doc list, xhr: ", xhr, ", status: ", status);
            });
        }
    </script>
</head>

<body>
    <div id="root">
        <div id="drawer-menu" class="drawer-menu">
            <span id="menu-title" class="menu-title">USTC-Lab418</span>
            <ul id="menu-ul" class="menu-ul">
            </ul>
        </div>
        <div id="main-container" class="main-body">
            <div id="docs">
                <div class="body-header">
                    <span id="docTitle" class="body-sub-title">常用信息记录</span>
                </div>
                <ul id="docList">
                </ul>
            </div>
        </div>
    </div>
</body>

</html>


<!-- svg
<div class="card">
    <div class="card-header">
        <span class="card-title">halo</span>
        <svg class="card-edit" t="1596247894872" class="icon" viewBox="0 0 1024 1024" version="1.1"
            xmlns="http://www.w3.org/2000/svg" p-id="1178" width="32" height="32">
            <path
                d="M532.392 320.217c58.751 58.642 116.557 116.356 176.408 176.083-1.934 1.161-4.921 2.257-6.976 4.299-87.523 86.596-175.141 173.078-262.184 260.154-11.369 11.369-23.604 18.609-38.937 22.958-59.724 16.953-119.201 34.773-178.802 52.192-13.288 3.881-23.684 0.384-30.382-9.934-4.424-6.804-4.409-14.246-2.259-21.625 19.028-65.153 38.084-130.294 57.421-195.34 1.409-4.703 4.409-9.468 7.904-12.947 90.756-90.028 181.7-179.871 272.563-269.778 1.962-1.95 3.635-4.206 5.243-6.063zM289.594 637.111c-0.913 2.722-1.626 4.672-2.212 6.668-8.047 27.285-15.1 54.914-24.474 81.737-4.887 13.983-3.541 23.822 8.664 32.128 2.257 1.533 4.207 3.696 5.891 5.876 2.662 3.482 5.631 3.577 9.576 2.383 22.307-6.743 44.69-13.269 67.058-19.844 11.186-3.296 22.382-6.561 34.358-10.055-1.872-2.137-2.893-3.82-4.362-4.873-9.205-6.667-13.288-15.516-12.452-26.902 0.323-4.239-0.247-8.554-0.496-12.837-0.727-11.88-1.484-23.762-2.259-35.922-16.366-1.345-31.911-2.968-47.487-3.772-11.372-0.589-22.105-1.72-29.051-12.347-0.435-0.663-1.284-1.065-2.752-2.241z"
                p-id="1179"></path>
            <path
                d="M794.821 397.313c-55.549-55.47-110.991-110.849-167.034-166.816 13.474-12.252 24.335-28.292 42.046-36.83 21.346-10.272 47.875-5.414 66.808 13.194 27.49 27.038 54.87 54.218 81.786 81.846 24.887 25.522 24.47 59.989-0.309 85.51-7.752 7.968-15.779 15.656-23.296 23.095z"
                p-id="1180"></path>
            <path
                d="M772.144 430.138c-12.482 11.696-25.447 23.822-38.101 35.671-58.284-58.284-116.2-116.186-174.425-174.411 12.762-11.958 25.708-24.1 38.083-35.705 58.194 58.18 116.062 116.050 174.442 174.443z"
                p-id="1181"></path>
        </svg>
        <svg class="card-delete" t="1596248692838" class="icon" viewBox="0 0 1024 1024"
            version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="2388" width="32" height="32">
            <path
                d="M128 213.33h768v85.33H128zM384 85.33h256v85.33H384zM384 384h85.33v384H384zM554.67 384H640v384h-85.33z"
                p-id="2389"></path>
            <path d="M725.33 853.33H298.67V384h-85.34v554.67h597.34V384h-85.34z" p-id="2390"></path>
        </svg>
    </div>
    <span class="card-paragraph">使用 Bootstrap 工具包来创建基于导航、标签、</span>
</div>
 -->